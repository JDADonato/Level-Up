<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Level Up | Premium Task Manager</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#18181b">
    <link rel="icon" href="task_logo.png">
    <link rel="apple-touch-icon" href="task_logo.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
</head>
<body class="overflow-x-hidden selection:bg-pink-500/30 selection:text-pink-200">

    <div id="loading-overlay" class="fixed inset-0 bg-black/80 backdrop-blur-md hidden flex items-center justify-center flex-col gap-4">
        <div class="relative">
            <div class="w-16 h-16 border-4 border-yellow-400 border-t-transparent rounded-full animate-spin"></div>
            <i class="ph-fill ph-lightning absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-yellow-400 text-xl animate-pulse"></i>
        </div>
        <p class="text-white font-bold tracking-widest uppercase text-xs">Syncing Data...</p>
    </div>

    <div id="auth-container" class="auth-screen">
        <div class="w-full max-w-sm glass-panel p-8 rounded-[2.5rem] border border-white/10 shadow-2xl">
            <div class="mb-6 relative inline-block">
                <div class="w-16 h-16 rounded-full bg-gradient-to-br from-yellow-400 to-pink-400 flex items-center justify-center text-black shadow-lg mx-auto">
                    <i class="ph-bold ph-lightning text-3xl"></i>
                </div>
                <div class="absolute -bottom-2 -right-2 bg-white text-black text-[10px] font-bold px-2 py-0.5 rounded-full border border-zinc-200">v2.14</div>
            </div>
            <h1 class="text-3xl font-bold text-dynamic-main mb-2 tracking-tight">Level Up</h1>
            <p class="text-dynamic-muted mb-8 text-sm">Gamify your academic life.</p>

            <div id="login-form" class="space-y-4">
                <input type="email" id="login-email" class="w-full glass-input rounded-xl p-4 text-center text-sm" placeholder="Email Address">
                <div class="relative">
                    <input type="password" id="login-pass" class="w-full glass-input rounded-xl p-4 text-center text-sm" placeholder="Password">
                    <button onclick="togglePass('login-pass')" class="absolute right-4 top-1/2 -translate-y-1/2 text-dynamic-muted hover:text-dynamic-main"><i class="ph ph-eye"></i></button>
                </div>
                <div class="flex items-center justify-center gap-2 text-xs text-zinc-400">
                    <input type="checkbox" id="login-remember" class="custom-check w-4 h-4 rounded border border-zinc-600">
                    <label for="login-remember">Keep me logged in</label>
                </div>
                <button id="btn-login" onclick="handleAuth('login')" class="w-full bg-gradient-to-r from-pink-500 to-yellow-500 text-white font-bold py-4 rounded-xl shadow-lg hover:scale-[1.02] transition-transform">Log In</button>
                <p class="text-zinc-500 text-xs mt-4">New here? <button onclick="toggleAuthMode()" class="text-pink-400 font-bold hover:underline">Create Account</button></p>
            </div>

            <div id="signup-form" class="hidden space-y-4">
                <input type="text" id="signup-name" class="w-full glass-input rounded-xl p-4 text-center text-sm" placeholder="Your Name">
                <input type="email" id="signup-email" class="w-full glass-input rounded-xl p-4 text-center text-sm" placeholder="Email Address">
                <div class="relative">
                    <input type="password" id="signup-pass" class="w-full glass-input rounded-xl p-4 text-center text-sm" placeholder="Create Password (min 6 chars)">
                    <button onclick="togglePass('signup-pass')" class="absolute right-4 top-1/2 -translate-y-1/2 text-dynamic-muted hover:text-dynamic-main"><i class="ph ph-eye"></i></button>
                </div>
                <button id="btn-signup" onclick="handleAuth('signup')" class="w-full bg-white text-black font-bold py-4 rounded-xl hover:scale-[1.02] transition-transform">Sign Up</button>
                <p class="text-zinc-500 text-xs mt-4">Has account? <button onclick="toggleAuthMode()" class="text-yellow-400 font-bold hover:underline">Log In</button></p>
            </div>
        </div>
    </div>

    <header class="fixed top-0 w-full z-40 border-b backdrop-blur-xl transition-colors duration-300" style="background-color: var(--header-bg); border-color: var(--header-border);">
        <div class="max-w-4xl mx-auto px-4 py-3 flex justify-between items-center">
            <div id="level-header-area" class="flex items-center gap-3 cursor-pointer group" onclick="openLevelsModal()">
                <div class="relative w-12 h-12 flex items-center justify-center">
                    <svg class="w-full h-full transform -rotate-90">
                        <circle cx="24" cy="24" r="20" stroke="rgba(150,150,150,0.2)" stroke-width="4" fill="none"></circle>
                        <circle id="level-circle" cx="24" cy="24" r="20" stroke="#fcd34d" stroke-width="4" fill="none" stroke-dasharray="126" stroke-dashoffset="126" class="transition-all duration-1000"></circle>
                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center flex-col">
                        <span class="text-[8px] text-dynamic-muted uppercase font-bold group-hover:text-pink-400">Lvl</span>
                        <span id="level-display" class="text-sm font-bold text-dynamic-main leading-none">1</span>
                    </div>
                </div>
                <div class="flex flex-col">
                    <h1 class="font-bold text-lg tracking-wide bg-gradient-to-r from-yellow-400 to-pink-400 bg-clip-text text-transparent">Level Up</h1>
                    <span id="header-points" class="text-xs text-dynamic-muted font-medium group-hover:text-dynamic-main transition-colors">0 XP</span>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button onclick="openGamification()" class="p-2 rounded-full hover:bg-black/5 text-pink-400 hover:text-pink-500 transition">
                    <i class="ph-duotone ph-medal text-2xl"></i>
                </button>
                <button onclick="openSettings()" class="p-2 rounded-full hover:bg-black/5 text-dynamic-muted hover:text-dynamic-main transition">
                    <i class="ph ph-gear text-xl"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 pt-24 pb-32">
        <div class="flex justify-between items-end mb-6 px-1">
            <div>
                <h2 class="text-2xl font-bold text-dynamic-main flex items-center gap-2">
                    <span id="greeting">Hi</span> <span class="text-xl">âœ¨</span>
                </h2>
                <div class="text-xs text-dynamic-muted mt-1 flex items-center gap-2">
                    <span id="next-level-text">Next Level: 100 XP</span>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="openImportModal()" class="text-xs font-bold text-yellow-500 hover:text-yellow-600 flex items-center gap-1.5 px-4 py-2 rounded-full bg-yellow-500/10 border border-yellow-500/20 transition-all active:scale-95">
                    <i class="ph-bold ph-upload"></i> Import
                </button>
                <button onclick="fetchUserData()" class="text-xs font-bold text-pink-400 hover:text-pink-500 flex items-center gap-1.5 px-4 py-2 rounded-full bg-pink-500/10 border border-pink-500/20 transition-all active:scale-95">
                    <i id="sync-icon" class="ph-bold ph-arrows-clockwise"></i> Sync
                </button>
            </div>
        </div>

        <div id="quest-container" class="space-y-4 mb-4"></div>

        <div id="level-reward-card" class="hidden mb-6 glass-panel p-5 rounded-3xl border border-yellow-500/20 bg-gradient-to-r from-yellow-500/10 to-pink-500/10 relative overflow-hidden">
            <div class="flex justify-between items-center relative z-10">
                <div>
                    <span class="text-[10px] font-bold uppercase tracking-wider text-yellow-500">Current Goal</span>
                    <h3 id="level-reward-name" class="text-lg font-bold text-dynamic-main mt-1">Reward Name</h3>
                </div>
                <div class="h-10 w-10 rounded-full bg-gradient-to-br from-yellow-400 to-pink-400 flex items-center justify-center text-black shadow-lg">
                    <i class="ph-fill ph-gift text-xl"></i>
                </div>
            </div>
            <div class="mt-3 w-full bg-black/10 rounded-full h-1.5 overflow-hidden">
                <div id="level-progress-bar" class="h-full bg-gradient-to-r from-yellow-400 to-pink-400 w-0 transition-all duration-1000"></div>
            </div>
            <p id="xp-needed-text" class="text-[10px] text-dynamic-muted mt-2 text-right">0 XP to go!</p>
        </div>

        <div id="task-list" class="grid gap-3 md:grid-cols-2 lg:grid-cols-1 transition-all"></div>

        <div id="empty-state" class="hidden flex flex-col items-center justify-center py-20 text-center animate-fade-in">
            <div class="w-24 h-24 bg-black/5 rounded-full flex items-center justify-center mb-4 border border-black/5">
                <i class="ph-duotone ph-sparkle text-5xl text-yellow-400 opacity-80"></i>
            </div>
            <h3 class="text-dynamic-main font-medium">All Caught Up!</h3>
            <p class="text-dynamic-muted text-sm mt-1">Time to level up. âœ¨</p>
        </div>
    </main>

    <div id="fab-container" class="fixed bottom-8 right-8 flex flex-col gap-4 z-40 items-center">
        <button onclick="openQuestModal()" class="w-14 h-14 bg-zinc-800 hover:bg-zinc-700 text-white rounded-2xl shadow-lg border border-white/10 flex items-center justify-center transition-all transform hover:scale-105 active:scale-95 group" title="Create Quest Reward">
               <i class="ph-fill ph-gift text-2xl text-pink-400"></i>
        </button>

        <button onclick="openModal('create')" id="add-fab" class="w-14 h-14 bg-gradient-to-br from-yellow-400 to-pink-400 text-black rounded-2xl shadow-[0_8px_30px_rgba(251,207,232,0.4)] flex items-center justify-center transition-all transform hover:scale-105 active:scale-95 group">
            <i class="ph-bold ph-plus text-2xl transition-transform hover:rotate-90"></i>
        </button>
    </div>

    <div id="bundle-bar" class="fixed bottom-0 left-0 w-full glass-panel border-t border-dynamic p-4 z-50 transform translate-y-full transition-transform duration-300 flex justify-between items-center">
        <div>
            <p class="text-dynamic-main font-bold">Select Tasks</p>
            <p class="text-xs text-dynamic-muted">Add to reward bundle</p>
        </div>
        <div class="flex gap-2">
            <button onclick="toggleBundleMode()" class="px-4 py-2 rounded-xl bg-zinc-200 text-zinc-800 font-bold text-sm hover:bg-zinc-300">Cancel</button>
            <button onclick="finalizeBundleSelection()" class="px-6 py-2 rounded-xl bg-gradient-to-r from-pink-500 to-yellow-500 text-white font-bold text-sm shadow-lg">Done</button>
        </div>
    </div>
    
    <div id="delete-bar" class="fixed bottom-0 left-0 w-full glass-panel border-t border-dynamic p-4 z-50 transform translate-y-full transition-transform duration-300 flex justify-between items-center bg-red-800/90 border-red-700">
        <div>
            <p class="text-white font-bold">Delete Tasks</p>
            <p id="delete-count" class="text-xs text-red-300">0 tasks selected</p>
        </div>
        <div class="flex gap-2">
            <button onclick="toggleDeleteMode(false)" class="px-4 py-2 rounded-xl bg-red-700 text-white font-bold text-sm hover:bg-red-600">Cancel</button>
            <button onclick="confirmBatchDelete()" id="btn-batch-delete" class="px-6 py-2 rounded-xl bg-white text-red-800 font-bold text-sm shadow-lg disabled:opacity-50" disabled>
                <i class="ph-bold ph-trash"></i> Delete
            </button>
        </div>
    </div>
    <div id="levels-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-md" onclick="closeLevelsModal()"></div>
        <div class="relative w-full max-w-lg bg-white rounded-[2rem] p-0 shadow-2xl overflow-hidden max-h-[90vh] flex flex-col">
            <div class="p-6 bg-zinc-900 border-b border-zinc-800">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="text-2xl font-bold text-white flex items-center gap-2"><i class="ph-fill ph-map-trifold text-yellow-400"></i> Roadmap</h3>
                        <p class="text-xs text-zinc-400 mt-1">Plan your next rewards</p>
                    </div>
                    <button onclick="closeLevelsModal()" class="text-zinc-400 hover:text-white"><i class="ph-bold ph-x text-2xl"></i></button>
                </div>
            </div>
            <div id="levels-list" class="p-6 pt-8 overflow-y-auto flex-1 custom-scrollbar space-y-4">
                </div>
        </div>
    </div>
    
    <div id="import-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-md" onclick="closeImportModal()"></div>
        <div
            class="relative w-full max-w-lg bg-white rounded-[2rem] p-0 shadow-2xl overflow-hidden max-h-[90vh] flex flex-col">

            <div class="px-6 py-5 bg-zinc-900 flex justify-between items-center shrink-0 border-b border-zinc-800">
                <h3 class="text-xl font-bold text-white flex items-center gap-2"><i
                        class="ph-bold ph-upload text-yellow-400"></i> Task Import</h3>
                <button onclick="closeImportModal()"
                    class="p-2 rounded-full hover:bg-white/10 text-zinc-400 hover:text-white transition"><i
                        class="ph-bold ph-x text-lg"></i></button>
            </div>

            <div class="p-6 overflow-y-auto flex-1 custom-scrollbar space-y-4">

                <div class="bg-blue-50 border border-blue-100 rounded-xl p-4 text-sm space-y-1">
                    <p class="text-blue-700 font-bold">Required Format:</p>
                    <p class="text-blue-600 text-xs">Use CSV or TSV with these exact columns in the first row:</p>
                    <code
                        class="block mt-2 text-xs bg-blue-100 text-blue-800 p-2 rounded"><strong>subject | due date | category | progress | notes | link</strong></code>
                </div>

                <div class="pt-2">
                    <label for="task-import-file"
                        class="block text-xs font-bold text-zinc-500 uppercase tracking-wider mb-2">Select CSV/TSV
                        File</label>
                    <input type="file" id="task-import-file" accept=".csv, .tsv, .txt"
                        class="w-full glass-input rounded-xl p-3 text-sm settings-input file:mr-4 file:py-2 file:px-4 file:rounded-xl file:border-0 file:text-sm file:font-semibold file:bg-pink-50 file:text-pink-700 hover:file:bg-pink-100 cursor-pointer">
                </div>

                <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4 text-sm space-y-1">
                    <p class="text-yellow-700 font-bold flex items-center gap-1"><i class="ph-bold ph-warning"></i>
                        Settings Check</p>
                    <p class="text-yellow-600 text-xs mt-1">New Subjects/Categories will be added to your Settings
                        automatically. <strong>Categories must have XP points set</strong> manually after import.</p>
                </div>

                <button id="btn-import-tasks" onclick="startTaskImport()"
                    class="w-full bg-gradient-to-r from-pink-500 to-yellow-500 text-white font-bold py-3 rounded-xl shadow-lg hover:scale-[1.01] transition-transform">
                    Import & Sync Tasks
                </button>
                <p class="text-xs text-red-500 text-center" id="import-error-msg"></p>

            </div>
        </div>
    </div>
    <div id="bundle-name-modal" class="fixed inset-0 z-[60] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-xl"></div>
        <div class="relative w-full max-w-sm bg-white rounded-[2rem] p-6 shadow-2xl space-y-4">
            <h3 class="text-xl font-bold text-zinc-900">Name Your Quest</h3>
            <input type="text" id="new-bundle-name" class="w-full glass-input rounded-xl p-3 settings-input" placeholder="e.g. Movie Marathon">
            <input type="text" id="new-bundle-reward" class="w-full glass-input rounded-xl p-3 settings-input" placeholder="Reward Description">
            <button onclick="saveBundle()" class="w-full bg-gradient-to-r from-pink-500 to-yellow-500 text-white font-bold py-3 rounded-xl">Create Bundle</button>
            <button onclick="document.getElementById('bundle-name-modal').classList.add('hidden')" class="w-full text-zinc-500 text-xs hover:text-zinc-900">Cancel</button>
        </div>
    </div>

    <div id="confirm-modal" class="fixed inset-0 z-[90] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeConfirm()"></div>
        <div class="relative w-full max-w-sm bg-white rounded-[2rem] p-6 text-center shadow-2xl scale-100">
            <i class="ph-duotone ph-warning text-4xl text-red-400 mb-4"></i>
            <h3 id="confirm-title" class="text-xl font-bold text-zinc-900 mb-2">Are you sure?</h3>
            <p id="confirm-desc" class="text-zinc-500 text-sm mb-6">Action cannot be undone.</p>
            <div class="flex gap-3">
                <button onclick="closeConfirm()" class="flex-1 py-3 rounded-xl bg-zinc-200 text-zinc-800 font-bold hover:bg-zinc-300">Cancel</button>
                <button id="confirm-action-btn" class="flex-1 py-3 rounded-xl bg-red-500 text-white font-bold hover:bg-red-600">Confirm</button>
            </div>
        </div>
    </div>

    <div id="reset-modal" class="fixed inset-0 z-[80] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeResetModal()"></div>
        <div class="relative w-full max-w-sm bg-white rounded-[2rem] p-6 text-center shadow-2xl">
            <h3 class="text-xl font-bold text-zinc-900 mb-2">Danger Zone</h3>
            <p class="text-zinc-500 text-sm mb-6">Select what to reset.</p>
            <div class="space-y-3">
                <button onclick="confirmReset('settings')" class="w-full py-3 rounded-xl bg-zinc-100 hover:bg-zinc-200 text-zinc-900 text-sm font-bold">Reset Settings Only</button>
                <button onclick="confirmReset('game')" class="w-full py-3 rounded-xl bg-zinc-100 hover:bg-zinc-200 text-zinc-900 text-sm font-bold">Reset XP & Badges</button>
                <button onclick="confirmReset('all')" class="w-full py-3 rounded-xl bg-red-500 hover:bg-red-400 text-white text-sm font-bold shadow-lg shadow-red-500/20">Reset Everything</button>
            </div>
            <button onclick="closeResetModal()" class="mt-4 text-xs text-zinc-500 underline">Cancel</button>
        </div>
    </div>

    <div id="settings-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-md" onclick="closeSettings()"></div>
        <div class="relative w-full max-w-md h-[80vh] bg-white rounded-[2rem] p-0 shadow-2xl flex flex-col overflow-hidden">
            
            <div class="px-6 py-5 bg-zinc-900 flex justify-between items-center">
                <h3 class="text-xl font-bold text-white flex items-center gap-2">Settings <span class="text-pink-400 text-xs bg-white/10 px-2 py-0.5 rounded-full">v2.14</span></h3>
                <button onclick="closeSettings()" class="text-zinc-400 hover:text-white"><i class="ph-bold ph-x text-xl"></i></button>
            </div>

            <div class="flex p-2 gap-2 bg-zinc-100 mx-6 mt-4 rounded-xl shrink-0">
                <button onclick="switchTab('subjects')" id="tab-subjects" class="flex-1 py-2 text-sm font-bold rounded-lg text-zinc-500 transition-all tab-btn">Subjects</button>
                <button onclick="switchTab('categories')" id="tab-categories" class="flex-1 py-2 text-sm font-bold rounded-lg text-zinc-500 transition-all tab-btn">Categories</button>
                <button onclick="switchTab('profile')" id="tab-profile" class="flex-1 py-2 text-sm font-bold rounded-lg text-zinc-500 transition-all tab-btn">Profile</button>
            </div>

            <div class="p-6 overflow-y-auto flex-1 custom-scrollbar">
                
                <div id="content-subjects" class="space-y-4">
                    <div class="flex gap-2 h-12">
                        <input type="text" id="new-subject-input" placeholder="Add subject..." class="flex-1 glass-input rounded-xl p-3 text-sm settings-input">
                        <button onclick="addSubject()" class="bg-zinc-900 text-white w-12 rounded-xl flex items-center justify-center shadow-lg"><i class="ph-bold ph-plus text-lg"></i></button>
                    </div>
                    <div id="subjects-list" class="space-y-2 pb-4"></div>
                </div>

                <div id="content-categories" class="hidden space-y-4">
                    <div class="flex gap-2 h-12">
                        <input type="text" id="new-cat-name" placeholder="Name" class="flex-[2] glass-input rounded-xl p-3 text-sm settings-input">
                        <div class="flex-1 flex bg-zinc-100 border border-zinc-200 rounded-xl overflow-hidden min-w-[80px]">
                            <input type="number" id="new-cat-points" value="50" class="w-full bg-transparent text-center text-sm text-zinc-900 focus:outline-none appearance-none h-full">
                        </div>
                        <button onclick="addCategory()" class="bg-zinc-900 text-white w-12 shrink-0 rounded-xl flex items-center justify-center shadow-lg"><i class="ph-bold ph-plus text-lg"></i></button>
                    </div>
                    <div id="categories-list" class="space-y-2 pb-4"></div>
                </div>

                <div id="content-profile" class="hidden space-y-6">
                    <div>
                        <label class="text-xs font-bold text-zinc-500 uppercase tracking-wider mb-1 block">Your Name</label>
                        <input type="text" id="settings-name" class="w-full glass-input rounded-xl p-3 mt-1 settings-input">
                    </div>
                    
                    <div>
                        <label class="text-xs font-bold text-zinc-500 uppercase tracking-wider mb-2 block">Theme Color</label>
                        <div class="flex items-center gap-3 bg-zinc-100 p-3 rounded-xl border border-zinc-200">
                            <input type="color" id="settings-color" onchange="changeTheme(this.value)" class="w-10 h-10 rounded-lg cursor-pointer bg-transparent border-0 p-0">
                            <span class="text-sm text-zinc-600">Pick a background tint</span>
                        </div>
                    </div>

                    <div class="bg-blue-50 border border-blue-100 rounded-xl p-4">
                        <p class="text-xs text-blue-600"><i class="ph-bold ph-info"></i> Rewards are managed in the Level Menu. Click the <b>XP Circle</b> on the dashboard.</p>
                    </div>

                    <button onclick="saveProfile()" class="w-full py-3 text-sm font-bold bg-green-500 text-white rounded-xl shadow-lg transition-colors hover:bg-green-600">Save Profile Changes</button>
                    
                    <div class="h-px bg-zinc-100 my-4"></div>
                    
                    <button onclick="logout()" class="w-full py-3 text-sm font-bold text-zinc-600 bg-zinc-100 rounded-xl hover:bg-zinc-200 transition-colors flex justify-center items-center gap-2">
                        <i class="ph-bold ph-sign-out"></i> Log Out
                    </button>
                    <button onclick="openResetModal()" class="w-full py-3 text-sm font-bold text-red-500 bg-red-50 rounded-xl border border-red-100 hover:bg-red-100 transition-colors">
                        Reset Data...
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="task-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-md transition-opacity" onclick="closeModal()"></div>
        <div class="relative w-full max-w-[500px] max-h-[90vh] bg-white rounded-[2rem] flex flex-col transition-all duration-300 transform scale-95 opacity-0 overflow-hidden" id="modal-content">
            <div class="px-6 py-5 flex justify-between items-center shrink-0 bg-zinc-900">
                <h3 id="modal-title" class="text-xl font-bold text-white">New Task</h3>
                <button onclick="closeModal()" class="p-2 rounded-full hover:bg-white/10 text-zinc-400 hover:text-white transition"><i class="ph-bold ph-x text-lg"></i></button>
            </div>
            <div class="p-6 overflow-y-auto custom-scrollbar flex-1">
                <form id="task-form" onsubmit="handleFormSubmit(event)" class="space-y-4">
                    <input type="hidden" id="task-id">
                    <div>
                        <label class="block text-xs font-bold text-zinc-500 uppercase tracking-wider mb-2">Subject</label>
                        <select id="task-subject" class="w-full glass-input rounded-xl p-3 appearance-none cursor-pointer text-sm font-medium settings-input" required></select>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-xs font-bold text-zinc-500 uppercase tracking-wider mb-2">Category</label>
                            <select id="task-category" class="w-full glass-input rounded-xl p-3 appearance-none cursor-pointer text-sm font-medium settings-input"></select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-zinc-500 uppercase tracking-wider mb-2">Due Date</label>
                            <input type="date" id="task-date" class="w-full glass-input rounded-xl p-3 text-sm font-medium settings-input" required>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-zinc-500 uppercase tracking-wider mb-2">Notes</label>
                        <textarea id="task-notes" rows="3" class="w-full glass-input rounded-xl p-3 resize-none text-sm settings-input" placeholder="Details..."></textarea>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-zinc-500 uppercase tracking-wider mb-2">Link</label>
                        <input type="url" id="task-link" placeholder="https://" class="w-full glass-input rounded-xl p-3 text-sm settings-input">
                    </div>
                    <div id="modal-actions" class="pt-2">
                        <button type="submit" id="save-btn" class="w-full bg-zinc-900 text-white font-bold py-3 rounded-xl shadow-lg hover:bg-zinc-800 transition">Save Task</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="gamification-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-md" onclick="closeGamification()"></div>
        <div class="relative w-full max-w-lg bg-white rounded-[2rem] p-0 shadow-2xl overflow-hidden max-h-[90vh] flex flex-col">
            <div class="p-6 bg-zinc-900 border-b border-zinc-800">
                <div class="flex justify-between items-start">
                    <div><h3 class="text-2xl font-bold text-white">Achievements</h3><p class="text-xs text-zinc-400 mt-1">Level <span id="modal-level" class="text-yellow-400 font-bold">1</span></p></div>
                    <button onclick="closeGamification()" class="text-zinc-400 hover:text-white"><i class="ph-bold ph-x text-2xl"></i></button>
                </div>
            </div>
            <div class="p-6 overflow-y-auto space-y-6 custom-scrollbar">
                <div>
                    <h4 class="text-xs font-bold text-green-600 uppercase tracking-wider mb-3">Earned</h4>
                    <div id="badges-earned" class="grid grid-cols-3 gap-3"></div>
                </div>
                <div>
                    <h4 class="text-xs font-bold text-zinc-400 uppercase tracking-wider mb-3">Locked</h4>
                    <div id="badges-locked" class="grid grid-cols-3 gap-3"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="achievement-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-xl" onclick="closeAchievement()"></div>
        <div class="relative w-full max-w-sm glass-panel rounded-[2rem] p-8 text-center border border-yellow-500/50 shadow-[0_0_100px_rgba(252,211,77,0.4)] transform transition-all scale-100">
            
            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-32 h-32 bg-yellow-400/20 blur-3xl rounded-full -z-10"></div>
            
            <div id="ach-icon-container" class="mb-6 relative inline-block">
                <i id="ach-icon" class="ph-duotone ph-star text-7xl text-yellow-400 drop-shadow-[0_4px_10px_rgba(250,204,21,0.5)] animate-bounce"></i>
                <i class="ph-fill ph-sparkle absolute -top-2 -right-4 text-2xl text-white animate-pulse"></i>
                <i class="ph-fill ph-sparkle absolute bottom-0 -left-4 text-xl text-white animate-pulse" style="animation-delay: 0.3s"></i>
            </div>

            <h2 class="text-sm font-bold text-yellow-500 uppercase tracking-widest mb-1">Achievement Unlocked</h2>
            <h3 id="ach-name" class="text-3xl font-bold text-dynamic-main mb-2">Novice</h3>
            <p id="ach-desc" class="text-dynamic-muted mb-8 text-sm">Completed your first task</p>

            <button onclick="closeAchievement()" class="w-full bg-gradient-to-r from-yellow-400 to-yellow-500 text-black font-bold py-3.5 rounded-2xl shadow-lg hover:scale-[1.02] transition-transform">
                Awesome!
            </button>
        </div>
    </div>

    <div id="levelup-modal" class="fixed inset-0 z-[70] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-xl"></div>
        <div class="relative w-full max-w-sm glass-panel rounded-[2rem] p-8 text-center border border-yellow-500/50 shadow-[0_0_50px_rgba(252,211,77,0.3)]">
            <i class="ph-fill ph-crown text-6xl text-yellow-400 mb-4 float-anim"></i>
            <h2 class="text-3xl font-bold text-dynamic-main mb-2">Level Up!</h2>
            <p class="text-dynamic-muted mb-6">You reached Level <span id="levelup-level-display" class="font-bold text-pink-400">2</span></p>
            <div class="bg-black/5 p-4 rounded-xl border border-dynamic mb-6"><h3 id="levelup-reward-name" class="text-xl font-bold text-dynamic-main">Reward Name</h3></div>
            <button onclick="claimReward()" class="w-full bg-yellow-400 hover:bg-yellow-300 text-black font-bold py-3 rounded-xl mb-3 shadow-lg shadow-yellow-500/20">Claim & Receipt ðŸ§¾</button>
            <button onclick="document.getElementById('levelup-modal').classList.add('hidden')" class="text-dynamic-muted text-xs hover:text-dynamic-main">Close</button>
        </div>
    </div>

    <div id="celebration-modal" class="fixed inset-0 z-[70] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-xl" onclick="closeCelebration()"></div>
        <div class="relative w-full max-w-sm glass-panel rounded-[2rem] p-8 text-center border border-pink-500/50 shadow-2xl">
            <i class="ph-fill ph-confetti text-6xl text-pink-400 mb-4 animate-bounce"></i>
            <h2 class="text-2xl font-bold text-dynamic-main mb-2">Quest Complete!</h2>
            <p class="text-dynamic-muted mb-4">You earned your reward:</p>
            <div class="bg-black/5 p-4 rounded-xl border border-dynamic mb-6"><h3 id="celebration-reward-name" class="text-xl font-bold text-dynamic-main">Reward</h3></div>
            <button onclick="closeCelebration()" class="w-full bg-pink-500 text-white font-bold py-3 rounded-xl">Awesome!</button>
        </div>
    </div>
    
    <div id="receipt-viewer-modal" class="fixed inset-0 z-[80] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-md" onclick="closeReceiptViewer()"></div>
        <div class="relative w-full max-w-sm bg-white rounded-[2rem] p-6 text-center shadow-2xl flex flex-col items-center">
            <h3 class="text-xl font-bold text-zinc-900 mb-4">Reward Receipt</h3>
            
            <img id="receipt-image-display" src="" alt="Level Up Reward Receipt" class="w-full max-w-[300px] rounded-lg border border-zinc-200 mb-6">
            
            <div class="flex gap-3 w-full">
                <button onclick="downloadReceipt()" class="flex-1 py-3 rounded-xl bg-yellow-400 text-black font-bold hover:bg-yellow-300">
                    Download
                </button>
                <button onclick="closeReceiptViewer()" class="flex-1 py-3 rounded-xl bg-zinc-200 text-zinc-800 font-bold hover:bg-zinc-300">
                    Close
                </button>
            </div>
        </div>
    </div>

    <div id="guide-modal" class="fixed inset-0 z-[60] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-xl" onclick="closeGuide()"></div>
        <div class="relative w-full max-w-md glass-panel rounded-[2rem] p-8 border border-pink-500/20 shadow-2xl flex flex-col max-h-[80vh]">
            <div class="text-center mb-6"><h2 class="text-2xl font-bold text-dynamic-main">Guide</h2></div>
            <div class="space-y-6 overflow-y-auto custom-scrollbar pr-2 text-sm text-dynamic-muted">
                <div class="flex gap-4">
                    <div class="w-8 h-8 rounded-full bg-zinc-800 flex items-center justify-center text-white font-bold shrink-0">1</div>
                    <div><p class="font-bold text-dynamic-main">Setup</p><p>Go to <i class="ph-bold ph-gear inline"></i> Settings. Add your <b>Subjects</b> and <b>Categories</b> (like Exams, Homework) so you can create tasks.</p></div>
                </div>
                <div class="flex gap-4">
                    <div class="w-8 h-8 rounded-full bg-zinc-800 flex items-center justify-center text-white font-bold shrink-0">2</div>
                    <div><p class="font-bold text-dynamic-main">Tasks & XP</p><p>Click the <b class="text-yellow-400">+</b> button to add tasks. Finishing tasks gives you XP based on the category value.</p></div>
                </div>
                <div class="flex gap-4">
                    <div class="w-8 h-8 rounded-full bg-zinc-800 flex items-center justify-center text-white font-bold shrink-0">3</div>
                    <div><p class="font-bold text-dynamic-main">Rewards</p><p>Click the <i class="ph-fill ph-gift inline text-pink-400"></i> button to create a <b>Bundle Reward</b>. Select multiple tasks and set a prize for finishing them all!</p></div>
                </div>
                <div class="flex gap-4">
                    <div class="w-8 h-8 rounded-full bg-zinc-800 flex items-center justify-center text-white font-bold shrink-0">4</div>
                    <div><p class="font-bold text-dynamic-main">Level Up</p><p>Earn XP to level up. Each level unlocks a receipt for your configured level reward. Click the XP Circle to plan rewards.</p></div>
                </div>
            </div>
            <button onclick="closeGuide()" class="mt-6 w-full bg-white text-black font-bold py-3 rounded-xl">Got it!</button>
        </div>
    </div>

    <canvas id="receipt-canvas" width="400" height="600" class="hidden"></canvas>
    <div id="toast-container" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 z-[60] pointer-events-none w-max max-w-[90%]"><div id="toast" class="toast glass-panel bg-white/90 px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 border border-pink-500/20 text-black"><i class="ph-fill ph-heart text-pink-400 text-lg"></i><span id="toast-message" class="text-sm font-bold">Updated</span></div></div>

    <script src="script.js" defer></script>
</body>
</html>
